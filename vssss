import { Component, OnInit } from '@angular/core';
import { AppointmentService } from 'src/app/services/appointment.service';
import { AuthService } from 'src/app/services/auth.service';

@Component({
  selector: 'app-dashboard-patient',
  templateUrl: './dashboard-patient.component.html',
  styleUrls: ['./dashboard-patient.component.css']
})
export class DashboardPatientComponent implements OnInit {
  appointments: any[] = [];
  patientId: number = 0;

  constructor(private appointmentService: AppointmentService, private authService: AuthService) {}

  ngOnInit(): void {
    const user = this.authService.getLoggedInUser();
    if (user) {
      this.patientId = user.id;
      this.getAppointments();
    }
  }

  getAppointments(): void {
    this.appointmentService.getAppointmentsByPatient(this.patientId).subscribe({
      next: (data) => this.appointments = data,
      error: (err) => console.error(err)
    });
  }

  cancelAppointment(id: number): void {
    if (confirm('Are you sure you want to cancel this appointment?')) {
      this.appointmentService.cancelAppointment(id).subscribe(() => {
        this.getAppointments();
      });
    }
  }

  updateStatus(id: number, status: string): void {
    this.appointmentService.updateAppointmentStatus(id, status).subscribe(() => {
      this.getAppointments();
    });
  }
}


<div class="dashboard-container">
  <h2>Your Appointments</h2>
  <div *ngIf="appointments.length === 0">No appointments found.</div>
  <div class="appointments-list">
    <div *ngFor="let appt of appointments" class="appointment-card">
      <p><strong>Doctor:</strong> {{ appt.doctorName }}</p>
      <p><strong>Date:</strong> {{ appt.date }}</p>
      <p><strong>Time:</strong> {{ appt.timeSlot }}</p>
      <p><strong>Status:</strong> {{ appt.status }}</p>
      
      <button *ngIf="appt.status === 'PENDING'" (click)="cancelAppointment(appt.id)">Cancel</button>
    </div>
  </div>
</div>


.dashboard-container {
  padding: 20px;
  background-color: #f7f7f7;
  min-height: 100vh;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

.appointments-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.appointment-card {
  background-color: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 0 8px rgba(0,0,0,0.1);
}


